# ===============================
# Hyprland - Final Optimized Config
# ===============================

# -------- Monitor --------
# Explicit monitor for laptop panel (fixes wallpaper + hyprpaper)
monitor = eDP-1,1920x1080@60,0x0,1

# -------- Environment (NVIDIA + Wayland) --------
env = WLR_NO_HARDWARE_CURSORS,1
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia

# -------- Variables --------
$mainMod = SUPER
$terminal = kitty
$fileManager = dolphin
$browser = firefox

# -------- Autostart --------
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Wallpaper (must start early)
exec-once = hyprpaper

# Notifications & tray
exec-once = mako
exec-once = nm-applet

# Bar
exec-once = waybar

# Core services
exec-once = mako
exec-once = nm-applet
exec-once = swww init
exec-once = hyprpaper

# Bar
exec-once = waybar

# -------- Input --------
input {
  kb_layout = us
  follow_mouse = 1

  touchpad {
    natural_scroll = true
  }
}

# -------- General --------
general {
  gaps_in = 6
  gaps_out = 12
  border_size = 2

  col.active_border = rgba(7aa2f7ff)
  col.inactive_border = rgba(414868aa)

  layout = dwindle
}

# -------- Decoration (Optimized) --------
decoration {
  rounding = 14

  blur {
    enabled = true
    size = 6
    passes = 2
    new_optimizations = true
  }

  shadow {
    enabled = true
    range = 20
    render_power = 3
    color = rgba(00000044)
  }
}

# -------- Animations (NVIDIA Friendly) --------
animations {
  enabled = true

  bezier = smooth, 0.25, 0.1, 0.25, 1.0

  animation = windows, 1, 5, smooth
  animation = windowsOut, 1, 5, smooth, popin 80%
  animation = border, 1, 3, default
  animation = fade, 1, 4, smooth
  animation = workspaces, 1, 4, smooth
}

# -------- Dwindle --------
dwindle {
  pseudotile = true
  preserve_split = true
}

# -------- Misc --------
misc {
  disable_hyprland_logo = true
  disable_splash_rendering = true
  mouse_move_enables_dpms = true
  key_press_enables_dpms = true
  vfr = true
}
exec-once = ~/.config/hypr/scripts/music_cache.sh

# -------- Keybindings --------
source = ~/.config/hypr/binds.conf

# ===============================
# Window Rules
# ===============================

# --- Floating rules ---
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = float, title:^(Open File|Save File|Save As|Select File)$

# --- Center floating windows ---
windowrulev2 = center, floating:1

# --- Spotify ---
windowrulev2 = float, class:^(Spotify)$
windowrulev2 = center, class:^(Spotify)$
windowrulev2 = size 900 600, class:^(Spotify)$

# --- Picture-in-Picture ---
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = pin, title:^(Picture-in-Picture)$
windowrulev2 = size 480 270, title:^(Picture-in-Picture)$
windowrulev2 = move 75% 75%, title:^(Picture-in-Picture)$

# --- Notifications ---
windowrulev2 = float, class:^(mako)$
windowrulev2 = noborder, class:^(mako)$
windowrulev2 = pin, class:^(mako)$

# --- Utility dialogs ---
windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = float, class:^(org.kde.kcalc)$

# Screenshots
bind = , Print, exec, grim ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S').png
bind = $mainMod, P, exec, grim -g "$(slurp)" ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S').png
